# M6 - 搜索与索引模块 PRD

## 模块概述

**模块名称**：搜索与索引模块  
**模块编号**：M6  
**优先级**：P2（中等优先级）  
**目标用户**：全体系统用户（普通用户 + 管理员）

### 业务目标

本模块旨在解决以下核心业务问题：

1. **内容检索**：帮助用户快速找到感兴趣的帖子和讨论
2. **知识发现**：通过搜索功能，让优质内容被更多人发现
3. **精准定位**：支持多种搜索条件组合，精准定位目标内容
4. **搜索体验**：提供搜索建议和热门搜索，优化搜索体验

### 模块边界

> ⚠️ **职责范围**：本模块仅负责帖子的搜索和检索功能，不涉及帖子内容的创建、编辑等管理功能。内容管理由 M3 内容管理模块负责。

**与其他模块的关系**：

- **依赖 M1**：验证用户身份
- **依赖 M2**：获取作者信息
- **依赖 M3**：获取帖子内容，接收内容变更通知
- **依赖 M5**：获取板块信息

---

## 功能需求

### 1. 全文搜索

#### 1.1 业务场景

**使用场景**：用户想通过关键词查找相关的帖子。

**用户故事**：

- 作为一个论坛用户，我希望能够通过关键词搜索帖子，快速找到我需要的信息。
- 作为一个论坛用户，我希望搜索结果能够同时匹配标题和内容，不错过相关帖子。
- 作为一个论坛用户，我希望搜索结果按相关度排序，最相关的帖子显示在前面。

#### 1.2 功能说明

用户输入关键词，系统在帖子标题和内容中搜索匹配的结果。

**搜索范围**：

- 帖子标题
- 帖子内容

**搜索方式**：

- 关键词搜索（支持多个关键词，空格分隔）
- 模糊匹配
- 不区分大小写

**输出结果**：

- 搜索结果列表（与帖子列表格式相同）
- 高亮显示匹配的关键词
- 按相关度排序

#### 1.3 业务规则

**搜索限制**：

- 关键词最小长度：2 个字符
- 关键词最大长度：50 个字符
- 最多支持 5 个关键词

**搜索范围**：

- 仅搜索未删除的帖子
- 所有板块的帖子都可被搜索

**结果排序**：

- 默认按相关度排序（标题匹配优先于内容匹配）
- 支持按发布时间排序
- 支持按点赞数排序
- 支持按回复数排序

**分页规则**：

- 每页显示 20 条结果
- 支持翻页

**关键词高亮**：

- 在搜索结果的标题和摘要中高亮显示匹配的关键词
- 使用醒目的颜色标识

#### 1.4 交互流程

1. 用户在导航栏的搜索框输入关键词
2. 按回车键或点击搜索按钮
3. 跳转到搜索结果页面
4. 显示搜索结果列表
5. 关键词在标题和摘要中高亮显示
6. 用户可以点击帖子查看详情
7. 用户可以切换排序方式
8. 用户可以翻页查看更多结果

---

### 2. 按作者筛选

#### 2.1 业务场景

**使用场景**：用户想查看某个特定作者的所有帖子。

**用户故事**：

- 作为一个论坛用户，我希望能够搜索某个用户发布的所有帖子。
- 作为一个论坛用户，我希望能够结合关键词和作者进行搜索，精准定位内容。

#### 2.2 功能说明

在搜索时可以指定作者，筛选该作者发布的帖子。

**筛选方式**：

- 输入作者用户名
- 从下拉列表选择作者

**搜索组合**：

- 仅按作者搜索：返回该作者的所有帖子
- 关键词 + 作者：在该作者的帖子中搜索关键词

#### 2.3 业务规则

**作者筛选**：

- 输入完整或部分用户名
- 自动提示匹配的用户
- 支持选择多个作者（最多 3 个）

**搜索范围**：

- 仅搜索指定作者的帖子
- 不搜索其他用户的帖子

#### 2.4 交互流程

1. 用户在搜索页面点击"作者筛选"
2. 输入作者用户名
3. 从下拉列表选择作者
4. （可选）输入关键词
5. 点击"搜索"
6. 显示该作者的帖子列表（或包含关键词的帖子）

---

### 3. 按板块筛选

#### 3.1 业务场景

**使用场景**：用户想在特定板块中搜索内容。

**用户故事**：

- 作为一个论坛用户，我希望能够在特定板块中搜索，缩小搜索范围。
- 作为一个论坛用户，我希望能够同时选择多个板块进行搜索。

#### 3.2 功能说明

在搜索时可以指定板块，筛选该板块的帖子。

**筛选方式**：

- 选择单个板块
- 选择多个板块
- 全部板块（默认）

**搜索组合**：

- 仅按板块搜索：返回该板块的所有帖子（等同于板块筛选）
- 关键词 + 板块：在指定板块中搜索关键词

#### 3.3 业务规则

**板块筛选**：

- 支持选择多个板块（最多 5 个）
- 仅搜索选中板块的帖子
- 默认搜索全部板块

**显示规则**：

- 搜索结果显示帖子所属板块
- 可以点击板块徽章进入该板块

#### 3.4 交互流程

1. 用户在搜索页面点击"板块筛选"
2. 勾选需要搜索的板块
3. （可选）输入关键词
4. 点击"搜索"
5. 显示选中板块中的搜索结果

---

### 4. 按时间范围筛选

#### 4.1 业务场景

**使用场景**：用户想查找特定时间段内的帖子。

**用户故事**：

- 作为一个论坛用户，我希望能够搜索最近一周的帖子，了解最新讨论。
- 作为一个论坛用户，我希望能够自定义时间范围，查找特定时期的内容。

#### 4.2 功能说明

在搜索时可以指定时间范围，筛选该时间段内发布的帖子。

**时间范围选项**：

- 全部时间（默认）
- 最近 24 小时
- 最近一周
- 最近一个月
- 最近一年
- 自定义时间范围

#### 4.3 业务规则

**时间筛选**：

- 按帖子发布时间筛选
- 包含起始和结束时间

**搜索组合**：

- 可以与关键词、作者、板块组合使用

#### 4.4 交互流程

1. 用户在搜索页面选择时间范围
2. 或点击"自定义"选择起始和结束日期
3. 输入关键词（可选）
4. 点击"搜索"
5. 显示时间范围内的搜索结果

---

### 5. 搜索建议

#### 5.1 业务场景

**使用场景**：用户在输入关键词时，系统提供搜索建议。

**用户故事**：

- 作为一个论坛用户，我希望在输入时看到搜索建议，快速选择关键词。
- 作为一个论坛用户，我希望看到热门搜索词，发现受欢迎的话题。

#### 5.2 功能说明

当用户在搜索框输入时，实时显示搜索建议。

**建议来源**：

- 历史搜索记录（本人的）
- 热门搜索词（全站）
- 匹配的帖子标题

**显示数量**：

- 最多显示 10 条建议

#### 5.3 业务规则

**建议触发**：

- 输入至少 2 个字符时显示建议
- 输入过程中实时更新建议

**建议排序**：

- 先显示历史搜索（最近 5 条）
- 再显示热门搜索（最热 5 条）
- 按搜索频次排序

**隐私保护**：

- 历史搜索仅本人可见
- 可以清除搜索历史

#### 5.4 交互流程

1. 用户在搜索框输入关键词
2. 输入 2 个字符后，显示搜索建议下拉框
3. 显示历史搜索和热门搜索
4. 用户可以点击建议直接搜索
5. 或继续输入完整关键词

---

### 6. 热门搜索

#### 6.1 业务场景

**使用场景**：用户想了解当前论坛的热门话题。

**用户故事**：

- 作为一个论坛用户，我希望看到热门搜索词，了解大家都在讨论什么。
- 作为一个论坛用户，我希望能够点击热门搜索词，快速查看相关内容。

#### 6.2 功能说明

在搜索页面显示最近的热门搜索词。

**显示位置**：

- 搜索页面顶部
- 搜索框下方

**显示信息**：

- 热门搜索词列表（前 10 个）
- 搜索次数（可选）

#### 6.3 业务规则

**统计规则**：

- 统计最近 7 天的搜索词
- 按搜索次数排序
- 去重相同的搜索词

**更新频率**：

- 每小时更新一次

**显示限制**：

- 最多显示 10 个热门搜索词
- 过滤无意义的搜索词（如单个字符）

#### 6.4 交互流程

1. 用户访问搜索页面
2. 页面顶部显示"热门搜索"区域
3. 显示当前热门的搜索词
4. 用户点击某个热门搜索词
5. 自动执行搜索，显示结果

---

### 7. 搜索历史

#### 7.1 业务场景

**使用场景**：用户想查看自己之前搜索过的内容。

**用户故事**：

- 作为一个论坛用户，我希望能够查看我的搜索历史，快速重复之前的搜索。
- 作为一个论坛用户，我希望能够删除搜索历史，保护隐私。

#### 7.2 功能说明

系统记录用户的搜索历史，供用户快速访问。

**显示位置**：

- 搜索框下拉建议中
- 搜索页面的"我的搜索"区域

**显示信息**：

- 搜索关键词
- 搜索时间
- 搜索结果数量

#### 7.3 业务规则

**记录规则**：

- 自动记录每次搜索
- 相同关键词只记录最新一次
- 最多保留 50 条历史记录

**隐私保护**：

- 搜索历史仅本人可见
- 用户可以删除单条历史
- 用户可以清空全部历史

**显示规则**：

- 按搜索时间倒序显示
- 最近搜索的在前

#### 7.4 交互流程

**查看历史**：

1. 用户点击搜索框
2. 显示最近 10 条搜索历史
3. 用户可以点击历史记录快速搜索

**删除历史**：

1. 用户在搜索历史旁点击"删除"
2. 该条记录被移除
3. 或点击"清空历史"删除全部

---

### 8. 高级搜索

#### 8.1 业务场景

**使用场景**：用户需要通过多个条件组合搜索，精准定位内容。

**用户故事**：

- 作为一个论坛用户，我希望能够同时使用关键词、作者、板块、时间等条件搜索。
- 作为一个论坛用户，我希望能够按点赞数、回复数筛选，找到最受欢迎的内容。

#### 8.2 功能说明

提供高级搜索功能，支持多条件组合。

**搜索条件**：

- 关键词（标题/内容）
- 作者
- 板块
- 时间范围
- 最小点赞数
- 最小回复数
- 是否有图片

**条件组合**：

- 所有条件为"且"关系
- 必须同时满足所有条件

#### 8.3 业务规则

**条件限制**：

- 至少提供一个搜索条件
- 可以只选择筛选条件，不输入关键词

**结果排序**：

- 默认按相关度排序
- 支持切换其他排序方式

#### 8.4 交互流程

1. 用户点击"高级搜索"
2. 展开高级搜索表单
3. 填写多个搜索条件：
   - 输入关键词
   - 选择作者
   - 选择板块
   - 设置时间范围
   - 设置最小点赞数/回复数
4. 点击"搜索"
5. 显示符合所有条件的搜索结果

---

### 9. 搜索结果展示

#### 9.1 业务场景

**使用场景**：用户查看搜索结果，快速浏览和筛选。

**用户故事**：

- 作为一个论坛用户，我希望搜索结果清晰展示，能够快速判断是否是我需要的内容。
- 作为一个论坛用户，我希望能够在搜索结果中看到内容摘要，无需逐个点开查看。

#### 9.2 功能说明

以列表形式展示搜索结果，提供丰富的信息预览。

**显示信息**：

每个搜索结果显示：

- 标题（关键词高亮）
- 内容摘要（前 200 字，关键词高亮）
- 作者头像和昵称
- 发布时间
- 所属板块
- 统计数据：浏览量、回复数、点赞数

**排序选项**：

- 相关度（默认）
- 发布时间
- 点赞数
- 回复数

**无结果提示**：

- 搜索无结果时，显示友好提示
- 提供搜索建议（如检查拼写、减少关键词等）
- 显示热门搜索词

#### 9.3 业务规则

**结果数量**：

- 显示搜索结果总数
- 显示当前页码和总页数

**高亮显示**：

- 标题中的关键词高亮
- 摘要中的关键词高亮
- 使用醒目颜色（如黄色背景）

**分页**：

- 每页 20 条结果
- 支持翻页

#### 9.4 交互流程

1. 用户执行搜索
2. 显示搜索结果页面
3. 顶部显示：
   - 搜索关键词
   - 结果总数
   - 排序选项
4. 显示搜索结果列表
5. 用户可以：
   - 点击帖子查看详情
   - 切换排序方式
   - 翻页查看更多结果
   - 修改搜索条件重新搜索

---

### 10. 清空搜索条件

#### 10.1 业务场景

**使用场景**：用户想重新开始搜索，清除当前的搜索条件。

**用户故事**：

- 作为一个论坛用户，我希望能够一键清空所有搜索条件，重新开始搜索。

#### 10.2 功能说明

提供"清空"按钮，清除所有搜索条件。

**清空内容**：

- 关键词
- 作者筛选
- 板块筛选
- 时间范围
- 其他筛选条件

#### 10.3 业务规则

**清空后状态**：

- 所有搜索条件恢复默认值
- 搜索结果清空
- 停留在搜索页面

#### 10.4 交互流程

1. 用户在搜索页面点击"清空"按钮
2. 所有搜索条件被清空
3. 搜索结果清空
4. 可以重新输入搜索条件

---

## 搜索统计规则

### 搜索次数统计

**统计内容**：

- 每个搜索词的搜索次数
- 每个用户的搜索次数
- 每日搜索总量

**用途**：

- 生成热门搜索排行
- 分析用户兴趣
- 优化搜索体验

### 热门搜索计算

**计算规则**：

- 统计最近 7 天的搜索词
- 按搜索次数降序排列
- 去重相同的搜索词

**更新频率**：

- 每小时更新一次

---

## 权限验证

**操作权限**：

- 搜索功能：需要登录
- 查看搜索结果：需要登录
- 查看搜索历史：仅本人
- 删除搜索历史：仅本人

**数据隔离**：

- 搜索历史仅本人可见
- 搜索结果对所有人相同（基于相同搜索条件）

---

## 测试场景

### 1. 全文搜索测试场景

| 场景编号 | 测试场景   | 操作步骤               | 预期结果                  |
| -------- | ---------- | ---------------------- | ------------------------- |
| TC-001   | 正常搜索   | 输入关键词，点击搜索   | 显示包含关键词的帖子列表  |
| TC-002   | 关键词为空 | 不输入关键词，点击搜索 | 提示"请输入搜索关键词"    |
| TC-003   | 关键词过短 | 输入 1 个字符          | 提示"关键词至少 2 个字符" |
| TC-004   | 多个关键词 | 输入多个关键词         | 搜索包含所有关键词的帖子  |
| TC-005   | 标题匹配   | 搜索在标题中的关键词   | 标题匹配的帖子排在前面    |
| TC-006   | 内容匹配   | 搜索在内容中的关键词   | 显示内容包含关键词的帖子  |
| TC-007   | 无搜索结果 | 搜索不存在的关键词     | 显示"未找到相关内容"      |
| TC-008   | 关键词高亮 | 查看搜索结果           | 关键词高亮显示            |

### 2. 按作者筛选测试场景

| 场景编号 | 测试场景    | 操作步骤             | 预期结果                   |
| -------- | ----------- | -------------------- | -------------------------- |
| TC-101   | 按作者搜索  | 选择作者，点击搜索   | 显示该作者的所有帖子       |
| TC-102   | 关键词+作者 | 输入关键词，选择作者 | 显示该作者包含关键词的帖子 |
| TC-103   | 多个作者    | 选择多个作者         | 显示所有选中作者的帖子     |
| TC-104   | 作者不存在  | 选择不存在的作者     | 提示"未找到该作者"         |

### 3. 按板块筛选测试场景

| 场景编号 | 测试场景    | 操作步骤             | 预期结果                   |
| -------- | ----------- | -------------------- | -------------------------- |
| TC-201   | 按板块搜索  | 选择板块，点击搜索   | 显示该板块的所有帖子       |
| TC-202   | 关键词+板块 | 输入关键词，选择板块 | 显示该板块包含关键词的帖子 |
| TC-203   | 多个板块    | 选择多个板块         | 显示所有选中板块的帖子     |

### 4. 按时间筛选测试场景

| 场景编号 | 测试场景    | 操作步骤             | 预期结果                       |
| -------- | ----------- | -------------------- | ------------------------------ |
| TC-301   | 最近一周    | 选择"最近一周"，搜索 | 显示一周内的搜索结果           |
| TC-302   | 自定义时间  | 选择起始和结束日期   | 显示时间范围内的搜索结果       |
| TC-303   | 时间+关键词 | 选择时间，输入关键词 | 显示时间范围内包含关键词的帖子 |

### 5. 搜索建议测试场景

| 场景编号 | 测试场景 | 操作步骤              | 预期结果           |
| -------- | -------- | --------------------- | ------------------ |
| TC-401   | 显示建议 | 在搜索框输入 2 个字符 | 显示搜索建议下拉框 |
| TC-402   | 历史搜索 | 查看搜索建议          | 显示本人历史搜索   |
| TC-403   | 热门搜索 | 查看搜索建议          | 显示全站热门搜索   |
| TC-404   | 点击建议 | 点击建议的搜索词      | 自动执行搜索       |
| TC-405   | 清除历史 | 点击"清除搜索历史"    | 历史记录被清空     |

### 6. 高级搜索测试场景

| 场景编号 | 测试场景   | 操作步骤                 | 预期结果                   |
| -------- | ---------- | ------------------------ | -------------------------- |
| TC-501   | 多条件搜索 | 输入多个搜索条件，搜索   | 显示同时满足所有条件的帖子 |
| TC-502   | 仅筛选条件 | 不输入关键词，只选择板块 | 显示该板块的所有帖子       |
| TC-503   | 最小点赞数 | 设置最小点赞数为 10      | 显示点赞数 ≥ 10 的搜索结果 |
| TC-504   | 有图片筛选 | 勾选"包含图片"           | 仅显示包含图片的帖子       |

---

## 功能清单

### 普通用户功能

- [x] 全文搜索（标题 + 内容）
- [x] 按作者筛选
- [x] 按板块筛选
- [x] 按时间范围筛选
- [x] 搜索建议
- [x] 查看热门搜索
- [x] 查看搜索历史
- [x] 删除搜索历史
- [x] 高级搜索
- [x] 清空搜索条件

### 管理员功能

- [x] 查看搜索统计（由 M8 系统管理模块提供）

---

**文档版本：** v1.0（纯需求版）  
**创建日期：** 2025-10-27  
**最后更新：** 2025-10-27  
**文档类型：** 产品需求文档（PRD）
